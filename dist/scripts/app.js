function initMap(){function e(e){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1400)}function o(e){return"<img src='"+e.image_url+"' width='40px'/><br/>"+(e.isclose?"closed":"opening")+"<br/>phone: "+e.phone+"<br/>"+e.name+"<br/>"+e.location.display_address.join(",")+"<br/>"}function n(n,t){var a=this;a.data=n,a.marker=new google.maps.Marker({map:t,position:new google.maps.LatLng(a.data.coordinates.latitude,a.data.coordinates.longitude)}),a.showDetail=function(){t.setCenter(new google.maps.LatLng(a.data.coordinates.latitude,a.data.coordinates.longitude)),t.setZoom(15),infoWindow.close(),infoWindow.setContent(o(a.data)),infoWindow.open(t,a.marker)},a.clickMarkerDetail=function(){e(a.marker),a.showDetail()},google.maps.event.addListener(a.marker,"click",a.clickMarkerDetail),a.clear=function(){a.marker.setMap(null)},a.show=function(){a.marker.setMap(t)},a.show()}function t(e,o){return $.ajax({url:"http://localhost:8888",data:e,type:"POST",success:function(e){"error"in e?alert("system error"):o(e)},fail:function(e){alert("system error")}})}function a(){var e=this;e.showMenu=ko.observable(!0),e.searchWord=ko.observable(""),e.searchItems=ko.observableArray([]),e.type=ko.observable("store"),e.toggleMenu=function(){e.showMenu(!this.showMenu())},t(request={action:"s",location:"San fransaco",limit:50},function(o){init=!0,places=o.businesses.map(function(e){return new n(e,map)}),e.searchItems(places),ko.computed(function(){var o=e.searchWord().toLowerCase();""===o?(places.forEach(function(e){e.show()}),e.searchItems(places)):e.searchItems(ko.utils.arrayFilter(places,function(e){return e.data.name.toLowerCase().indexOf(o)>=0?(e.show(),!0):(e.clear(),!1)}))})})}map=new google.maps.Map(document.getElementById("map"),{center:centerPoint,zoom:13,zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!1}),infoWindow=new google.maps.InfoWindow,service=new google.maps.places.PlacesService(map),ko.applyBindings(new a)}var map,centerPoint={lat:37.77493,lng:-122.41942},places=[],infoWindow,service,request,init=!1;